version: '3.7'
services:
  postgres:
    #name of the docker  
    container_name: db
    # version of postgres 
    image: postgres:latest
    # setting for restart
    restart: on-failure
    environment:
      # creation of a user and a database
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: devops
      # declaration of ports
    ports:
      - 5432:5432
    volumes:
      - ./init-database.sh:/docker-entrypoint-initdb.d/init-database.sh
 
  pyapp:
    build: ./
    depends_on: 
    - postgres
    volumes:
      - ./app:/app
    ports:
      - "80:80"
    environment:
      - ADR=postgres
      - USR=postgres
      - DB=devops
      - PAWD=postgres
      - PRT=5432
